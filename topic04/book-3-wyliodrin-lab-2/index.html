 <!DOCTYPE html>
 <html>
   <head>

     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1">

     

     <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>

     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.4/semantic.min.css" type="text/css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/solarized-light.min.css" rel="stylesheet" />

     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.address/1.6/jquery.address.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.4/semantic.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/languages/java.min.js"></script>
     <script>hljs.initHighlightingOnLoad();</script>

     

     <style>
       

body 
{
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
}

figcaption
{
  margin-bottom: 20px;
}

.vertical-align
{
  display: flex;
  align-items: center;
}



     </style>

   </head>

  <body>
    

<style>
  

code
{
  font-family: "Monaco";
  font-size: 110%;
}

img
{
  padding:1px;
  border:1px solid black;
}

h1
{
  font-style:italic;
  font-size:130%;
  border-bottom:thin solid black;
}

h2
{
  font-size:110%;
  border-bottom: thin solid black;
}

h3
{
  font-size:100%;
  border-bottom: thin solid black;
}

body
{
  overflow-y: scroll;
}

.pushable > .pusher
{
  padding-bottom: 1.5rem;
}

.ui.segment.pushable
{
  margin: 0;
  padding: 1rem 0;
  overflow: visible;
}



</style>

<div class="ui fixed top pointing inverted menu labmenu">
  <header class="header item">
    <i id="toc" class="sitemap icon"></i>
    <a href="../index.html">
      Getting Started with Wyliodrin
    </a>
  </header>
  <div class="right tab-menu menu">
    
    <a class="item" data-tab="wyliodrin-lab-02">
      wyliodrin-lab-02
    </a>
    
    <a class="item" data-tab="01">
      01
    </a>
    
    <a class="item" data-tab="02">
      02
    </a>
    
    <a class="item" data-tab="03">
      03
    </a>
    
    <a class="item" href="../../index.html">
      <i class="home icon"></i>
    </a>
  </div>
</div>

<div class="ui segment pushable">
  <div class="ui inverted labeled icon left inline vertical sidebar menu">
    
      
        <a class="item" href="../../topic02/book-git-lab/index.html">
          git-lab-01
        </a>
      
    
      
        <a class="item" href="../../topic02/book-github-pages-lab/index.html">
          github-pages-lab-01
        </a>
      
    
      
        <a class="item" href="../../topic02/book-markdown-lab/index.html">
          markdown-lab-01
        </a>
      
    
      
        <a class="item" href="../../topic03/book-arduino-workshop/index.html">
          arduino-workshop-01
        </a>
      
    
      
        <a class="item" href="../../topic04/book-1-assignment-lab/index.html">
          Assignment
        </a>
      
    
      
        <a class="item" href="../../topic04/book-2-wyliodrin-lab/index.html">
          wyliodrin-lab-01
        </a>
      
    
      
        <a class="active item" href="../../topic04/book-3-wyliodrin-lab-2/index.html">
          wyliodrin-lab-02
        </a>
      
    
      
        <a class="item" href="../../topic04/book-4-wyliodrin-streams-lab/index.html">
          wyliodrin-lab-03
        </a>
      
    
  </div>
  <div class="pusher" tabindex="-1">
    <div class="ui basic segment">
      <br>
      
      <div  class="ui tab segment lab" data-tab="wyliodrin-lab-02">
        <h1>Wyliodrin: Sensors and Dashboard</h1>
<p>In this lab is taken from Innovation Labs IoT workshop ocw.cs.pub.ro/courses/iot/labs/08 . You will build a system to monitor the light level and if there is the case, you will turn on the street lights brighter or dimmer, depending on the amount of light.</p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="01">
        <h1>Introduction</h1>
<p>As previously stated, the classical Arduino board is basically a micro-controller, which is capable of running one piece of software at once and that has little processing power and no network connectivity. So you will use the board to gather data from the environment and then pass it on to the Raspberry Pi.</p>
<p>The Raspberry Pi is a computer that is capable of processing data and communicating with other smart devices. For instance, you could visualise the temperature on your smart phone.</p>
<h3>Connecting the Pi and Arduino</h3>
<p>The two boards need to be connected in order to send data between them. You can connect them via the USB cable and a serial connection will be established between the two. Once this is done, they can exchange data and the Arduino board can be controlled via the Raspberry Pi. This is done by the <strong>firmata</strong> protocol. The protocol allows the Raspberry Pi to send the Arduino messages in which it requests for a certain action or information and the Arduino will respond accordingly.</p>
<p>In order to implement the protocol, you need to flash the Arduino with the <strong>StandardFirmata</strong> firmware.</p>
<p>In the Wyliodrin STUDIO interface you have two tabs referring to <strong>Raspberry Pi</strong> and <strong>Arduino</strong>. Select the <strong>Arduino</strong> tab and there is where you can write code which will be run on the Arduino. In this case, you will import an existing project.</p>
<p><img src="./img/select-firmata.png" alt=""></p>
<p>Hit the <strong>Show examples</strong> button and select <strong>Arduino</strong>. Then <strong>use</strong> the <strong>Firmata/StandardFirmata</strong> example. Now that you have the software to run on the Arduino, once you hit the <strong>run</strong> button, you will be asked the type of the Arduino board and if you want to flash it or not. Select the board you are using and <strong>RUN AND FLASH</strong>. The <strong>StandardFirmata</strong> firmware will be deployed on the Arduino.</p>
<p>Any micro-controller, including the Arduino, once flashed, runs the same firmware until another one is uploaded on the board. Thus, you don&#39;t have to flash the board each time you run a new Raspberry Pi application. If you are confident that the Arduino is running <strong>StandardFirmata</strong>, you can skip this step.</p>
<p><img src="./img/flash-arduino.png" alt=""></p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="02">
        <h1>Build Circuit</h1>
<p>In this application, you will build a system to monitor the light level and if there is the case, you will turn on the street lights brighter or dimmer, depending on the amount of light.</p>
<h2>What you need</h2>
<ul>
<li><div class="li">One Raspberry Pi connect to \Wyliodrin;</div>
</li>
<li><div class="li">One Arduino connected to the Raspberry Pi;</div>
</li>
<li><div class="li">One photocell;</div>
</li>
<li><div class="li">One LED;</div>
</li>
<li><div class="li">One 220 Ω resistor</div>
</li>
<li><div class="li">One 10 kΩ resistor</div>
</li>
<li><div class="li">Jumper wires.</div>


</li>
</ul>
<h2>Physical Setup</h2>
<p><img src="./img/light_sensor_schematics.png" alt=""></p>
<p>The photocell works just like resistor with a variable resistance. Depending on the amount of light it receives, its resistance gets higher or lower. As a result, you can connect it in a voltage divider, as well.</p>
<p>The sensor is connected to the 5V via the 10 K Ohms resistor and to the GND pin on the other side. In order to read the sensor&#39;s value, the yellow jumper wire is connected to the A0 pin of the board. The A0-A5 pins can be used for reading digital values, in this case values ranging from 0 to 1024.</p>
<p>For the photocell, the resistance decreases proportionally with the amount of light, so for this schematics, the brighter the environment, the higher is the read value.</p>
<p>In addition, the photocell has a resistance varying from hundred of ohms to mega ohms and in order for the voltage divider to work, you should use the sensor as a pull-down resistor, while the actual resistor needs to have a resistance comparable with the sensor&#39;s, otherwise its effect is not visible. This is why you need a 10 k Ohms resistor.</p>
<p>The other part of the setup, the LED is connected similar to the previous schematics except that you can notice that its behaviour is controller by pin 3. That pin has a tilde next to it. That means that it is a PWM pin so you can control if the LED should light up brighter or dimmer. You can write values ranging from 0 to 255 on these pins, 0 being the equivalent of digital 0 and 255 the equivalent of digital 1.</p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="03">
        <h2>The Code</h2>
<div class="level3">

<img src="./img/street_lights_code.png" alt="">


First of all, you need to use an <strong>Arduino in</strong> node in order to read the values from the sensor. This node gets triggered each time the value on the pin it reads from changes. To actually configure the node&#39;s behavior you need to set its properties.

<img src="./img/arduino_in_properties.png" alt="">


The first property allows you to set the Raspberry Pi connection to the Arduino board so the Raspberry Pi knows the port through which it should send the messages. Usually, the port is <strong>/dev/ttyACM0</strong>. However, in order to make sure, go to the <strong>Shell</strong> tab and type <strong>dmesg</strong>. There you should see messages stating that an FTDI cable has been connected to the board and the port it is connected to. Concatenate that value to <strong>/dev/</strong> and place the value as the first property of the node.

Further on, you need to specify which pin you want to read from. In this case, the pin is 0 and is an analog pin. Afterwards, you will use a <strong>range</strong> node in order to map the read values to values that should light up the LED. For this, you need to adapt the system to your environment. Depending on the regular amount of light, usually you will read a value of around 400. So in this case, the range scales values going from 400 to 1024 to 0 to 255. However, if the regular value is different, you will need to scale a different range.

<img src="./img/range-light.png" alt=""><br>
The last node to use is <strong>Arduino out</strong>. This node acts just like the <strong>digital write</strong> node used in the previous chapters. However, you still need to select the port for the Arduino board and you can choose from analog or digital write. As you want to make the LED light up brighter or dimmer, you will set the type to <strong>analog</strong> and the <strong>pin</strong> property has to be 3.

<div class="noteclassic">If you use more than one Arduino node in the application, add a new Raspberry Pi board only for one node. For the rest of the nodes, choose the previously added board from the drop-down.</div>

<p>Now you can run the application and watch how the LED gets brighter as you cover up the sensor.</p>
<h2>Exercises</h2>
<ol>
<li><p>Display the values coming from the light sensor in the dashboard using the <strong>gauge</strong> graph.</p>
</li>
<li><p>Write the program using the Visual programming language. Create a new Visual Programming project called &quot;Street Lights Visual&quot; and use the following code:
<img src="./img/visual_code.png" alt=""></p>
</li>
<li><p>Connect all the sensors in the kit to the Arduino and display the values you read in the dashboard. <strong>Note:</strong> Do not connect the Hall sensor, which works in a different way.</p>
</li>
<li><p>Search the temperature sensor&#39;s datasheet online (TMP36) and transform the read values to celsius degrees.</div></p>
</li>
</ol>

      </div>
     
    </div>
  </div>
</div>
  <div class="ui bottom fixed borderless right menu">
    <div class="ui right tiny menu">
      <div class="ui mini message segment">
        Frank Walsh (fxwalsh@wit.ie).
        <a  href="http://creativecommons.org/licenses/by-nc/4.0/" title="External link to http://creativecommons.org/licenses/by-nc/4.0/"
            target="_blank">Creative Commons License
        </a>
      </div>
    </div>
  </div>

<script>
  $(document).on('keydown', function (e) {
  e = e || window.event;
  var nextTab;
  switch (e.which || e.keyCode) {
    case 37: // left
      nextTab = $('.tab-menu a[data-tab].active').prev('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').last();
      nextTab.click();
      $('.pusher').focus();
      break;

    case 39: // right
      nextTab = $('.tab-menu a[data-tab].active').next('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').first();
      nextTab.click();
      $('.pusher').focus();
      break;
  }
});

</script>

    <footer>

    </footer>
    <script>
      $(document).ready(function () {
  $('img').addClass('ui image');
  $('.ui.embed').embed();

  const $images = $('.lab img');
  jQuery.each($images, function (i) {
    if (($images[i].alt).length > 0) {
      const divImg = $(document.createElement('div')).addClass('ui basic segment');
      $($images[i]).wrap(divImg);
      const divLabel = $(document.createElement('div')).addClass('ui blue ribbon label');
      divLabel.append($images[i].alt);
      $(divLabel).insertBefore($images[i]);
    }
  });

  $('.ui.embed').embed();

  $('.ui.menu .item')
      .tab({
        history: true,
        historyType: 'hash',
      });

  $('.popup').popup();

  $('.ui.sidebar')
      .sidebar({ context: $('.pushable') })
      .sidebar('setting', 'transition', 'slide out')
      .sidebar('attach events', '#toc');
});

    </script>
  </body>

 </html>